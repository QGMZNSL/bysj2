package qxjc.peszp.action;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

import qxjc.peszp.dao.BaseDao;

@Controller
public class LoginAction{
	@RequestMapping("login")
	public String Login(HttpServletRequest request, HttpServletResponse response) {
		WebActionSupport ws = new WebActionSupport();
		Map userMap = new HashMap();
		HttpSession session = request.getSession();
		String userid = request.getParameter("userId");
		String userpass = request.getParameter("userPass");//文本框密码
		BaseDao bd = new BaseDao();		
		userMap = bd.login(userid);	
		boolean pass= false;
		if(userMap.size()==0){
			ws.OutWriteClient(response, "用户名不存在！","index.jsp");
			bd.userlog(userid, "失败", "用户名不存在！", ip);
			return "";
		}else {
			pass=userMap.get("userPass").toString().equals(userpass);
			if (!pass){
				ws.OutWriteClient(response, "密码错误！","index.jsp");
				bd.userlog(userid, "失败", "密码错误！", ip);
				return "";
			}else{
				bd.userlog(userid, "成功", " ", ip);
				session.setAttribute("User", userMap);
				session.setAttribute("userName", userMap.get("userName"));
				session.setAttribute("userRole", userMap.get("userRole"));
				return "main";			
			}
		}
		
	}
}
